(49, 119)
(47, 58)
from utils.load_state_graph import load_state_graph
from src.ant_colony import AntColony
import numpy as np
import os
os.environ["PYGAME_HIDE_SUPPORT_PROMPT"] = "1"

from data.data_5 import starting_times, lines, colors, map_size
from utils.path_utils import beautify_path, find_full_path
from utils.visualize_graph import visualize_map
from utils.printing import print_color
from utils.impute import impute_lines

if __name__ == "__main__":

    start_time = 0

    lines = impute_lines(lines)
    state_graph = load_state_graph(lines, starting_times)

    sx, sy, ex, ey = input().split()

    print(sx, sy, ex, ey)

    start_node = (int(sx), int(sy))
    end_node = (int(ex), int(ey))

    aco = AntColony(state_graph,
                    len(lines),
                    n_ants=20,
                    n_iterations=np.sqrt(abs(int(ex) - int(sx)) + abs(int(ey) - int(ex))),
                    alpha=2.0,
                    beta=0.1,
                    evaporation_rate=0.3,
                    q=15,
                    transfer_factor=3)

    try:
        visualize_map(lines, colors)
        best_path, best_length = aco.run(start=start_node, end=end_node, start_time=start_time)
        final_path = beautify_path(best_path)

        print("\nBest path found:")
        for point in final_path:
            print_color(point, color=colors[point[2]])
        print(f"Path length: {best_length} minutes")
        
        full_path = find_full_path(final_path, lines)
        visualize_map(lines, colors, full_path)
    except ValueError as e:
        print(e)